(function(){"use strict";const t=e=>document.getElementById(e),S=t("netStatus"),b=t("year"),M=t("pcl"),T=t("smmlvInfo"),D=t("kpiSml"),O=t("kpiSmlDv"),P=t("kpiCop"),E=t("dictamen"),c=t("btnCopyDictamen"),f=t("premiumStatus"),d=t("premiumUser"),m=t("premiumDays"),g=t("btnOpenLicense"),N=t("btnClearLicense"),r=t("licenseModal"),I=t("btnCloseLicense"),k=t("licenseToken"),$=t("btnValidateLicense"),x=t("btnCopyState"),w=t("licenseMsg"),y={2024:13e5,2025:1423500,2026:1750905};function a(e){return Number.isFinite(e)?e.toLocaleString("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}):"\u2014"}function C(e,n=1){return Number.isFinite(e)?e.toLocaleString("es-CO",{minimumFractionDigits:n,maximumFractionDigits:n}):"\u2014"}function A(e){return!Number.isFinite(e)||e<=0?0:e<=5?14:e<=50?14+(e-5)*3.5:180}function F(e){return(y[e]||0)/30}function V({year:e,pcl:n,sml:s,smlDvCop:o,totalCop:u,premiumState:L}){const i=[];return i.push("DICTAMEN PRELIMINAR \u2014 C\xC1LCULO PCL (SOAT)"),i.push("----------------------------------------"),i.push(`Fecha: ${new Date().toLocaleString("es-CO")}`),i.push(`A\xF1o base (SMMLV): ${e}  |  SMMLV: ${a(y[e]||0)}`),i.push(`PCL reportada: ${C(n,1)} %`),i.push(""),i.push(`Equivalencia aplicada (SMLDV): ${C(s,1)}`),i.push(`SMLDV (COP): ${a(o)}`),i.push(`Indemnizaci\xF3n estimada (COP): ${a(u)}`),i.push(""),i.push("Observaci\xF3n t\xE9cnica:"),i.push("- Tope m\xE1ximo por incapacidad permanente: 180 SMLDV."),i.push("- Equivalencia SMLDV implementada por tramos (seg\xFAn tablas divulgadas); para uso forense/jur\xEDdico, validar siempre contra norma vigente y dictamen de calificaci\xF3n."),i.push(""),i.push(`Estado de licencia: ${L}`),i.join(`
`)}function p(e,n){w.textContent=e||"",w.className="msg"+(n===!0?" ok":n===!1?" err":"")}function R(){r.classList.add("is-open"),r.setAttribute("aria-hidden","false"),k.value=window.PCLSOAT_LICENSE.loadToken(),p("",null)}function h(){r.classList.remove("is-open"),r.setAttribute("aria-hidden","true")}async function U(){const e=window.PCLSOAT_LICENSE.loadToken();if(!e)return f.innerHTML="Estado: <b>FREE</b>",d.style.display="none",m.style.display="none",{state:"FREE",isPremium:!1,user:"",daysLeft:0};const n=await window.PCLSOAT_LICENSE.verifyToken(e);if(!n.ok)return f.innerHTML='Estado: <b style="color:var(--danger)">FREE</b>',d.style.display="none",m.style.display="none",{state:"FREE",isPremium:!1,user:"",daysLeft:0,reason:n.reason||""};const s=n.payload?.user||"Usuario";return f.innerHTML='Estado: <b style="color:var(--accent)">PREMIUM</b>',d.textContent=`Usuario: ${s}`,m.textContent=`D\xEDas restantes: ${n.daysLeft}`,d.style.display="",m.style.display="",{state:"PREMIUM",isPremium:!0,user:s,daysLeft:n.daysLeft}}async function l(){const e=Number(b.value),n=Number(String(M.value).replace(",",".")),s=A(n),o=F(e),u=s*o;T.textContent=`SMMLV ${e}: ${a(y[e]||0)}  |  SMLDV aprox.: ${a(o)}`,D.textContent=s?C(s,1):"\u2014",O.textContent=o?a(o):"\u2014",P.textContent=u?a(u):"\u2014";const L=await U();L.isPremium?(E.value=V({year:e,pcl:n,sml:s,smlDvCop:o,totalCop:u,premiumState:L.state}),c.disabled=!1,c.style.display="inline-block"):(E.value=`\u{1F512} Dictamen preliminar disponible solo en versi\xF3n PREMIUM.

Activa tu licencia para habilitar:
- Dictamen textual
- Copiar/compartir
`,c.disabled=!0,c.style.display="none")}function v(){const e=navigator.onLine;S.textContent=e?"Online":"Offline",S.className="pill"+(e?"":" pill--muted")}b.addEventListener("change",l),M.addEventListener("input",l),c.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(E.value||"")}catch{}}),g.addEventListener("click",R),I.addEventListener("click",h),r.addEventListener("click",e=>{e.target===r&&h()}),N.addEventListener("click",async()=>{window.PCLSOAT_LICENSE.clearToken(),await l()}),$.addEventListener("click",async()=>{const e=(k.value||"").trim();if(!e)return p("Pega un token.",!1);const n=await window.PCLSOAT_LICENSE.verifyToken(e);if(!n.ok){p(n.reason||"Licencia no v\xE1lida.",!1);return}window.PCLSOAT_LICENSE.saveToken(e),p(`Licencia OK. Usuario: ${n.payload?.user||"\u2014"} | D\xEDas: ${n.daysLeft}`,!0),await l()}),x.addEventListener("click",async()=>{const e=window.PCLSOAT_LICENSE.loadToken(),n=e?`TOKEN:
${e}`:"Sin token (FREE).";try{await navigator.clipboard.writeText(n)}catch{}}),window.addEventListener("online",()=>{v()}),window.addEventListener("offline",()=>{v()}),v(),l()})();
